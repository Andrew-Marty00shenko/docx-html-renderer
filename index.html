<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script crossorigin src="https://unpkg.com/jszip/dist/jszip.min.js"></script>
    <script src="lib/docx2html.js"></script>
  </head>
  <body>
    <input id="file" type="file" accept=".docx" />
    <select id="options" multiple size="8"></select>

    <script>
      const fileInput = document.getElementById("file");
      const optionsSelect = document.getElementById("options");

      const options = { ...docx.defaultOptions };

      // fill select with boolean options
      Object.keys(options)
        .filter((k) => typeof options[k] === "boolean")
        .forEach((k) => {
          const opt = document.createElement("option");
          opt.value = k;
          opt.textContent = `${k}: ${options[k] ? "on" : "off"}`;
          opt.selected = !!options[k];
          optionsSelect.appendChild(opt);
        });

      optionsSelect.addEventListener("change", () => {
        for (const opt of Array.from(optionsSelect.options)) {
          options[opt.value] = opt.selected;
          opt.textContent = `${opt.value}: ${opt.selected ? "on" : "off"}`;
        }
        if (currentBlob) render(currentBlob);
      });

      let currentBlob = null;

      async function render(blob) {
        currentBlob = blob;
        if (!currentBlob) return;

        // ensure container exists
        let container = document.getElementById("docx-container");
        if (!container) {
          container = document.createElement("div");
          container.id = "docx-container";
          document.body.appendChild(container);
        }
        container.innerHTML = "";

        await docx.renderAsync(currentBlob, container, null, options);
      }

      fileInput.addEventListener("change", () => {
        const f = fileInput.files && fileInput.files[0];
        if (f) render(f);
      });
    </script>
  </body>
</html>
