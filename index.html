<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DOCX to HTML Converter</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .file-input {
        margin: 20px 0;
      }
      .options-container {
        margin: 20px 0;
      }
      .option-item {
        display: flex;
        align-items: center;
        margin: 10px 0;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background: #fafafa;
      }
      .option-item input[type="checkbox"] {
        margin-right: 10px;
        transform: scale(1.2);
      }
      .option-item label {
        cursor: pointer;
        user-select: none;
        flex: 1;
      }
      .render-button {
        background: #007bff;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin: 20px 0;
      }
      .render-button:hover {
        background: #0056b3;
      }
      .render-button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      #output {
        margin-top: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
        min-height: 200px;
        background: white;
      }
      #debug {
        margin-top: 20px;
        padding: 10px;
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        font-family: monospace;
        font-size: 12px;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>DOCX to HTML Converter</h1>

      <div class="file-input">
        <input type="file" id="fileInput" accept=".docx" />
      </div>

      <div class="options-container">
        <h3>Rendering Options:</h3>
        <div id="optionsList"></div>
      </div>

      <button id="renderButton" class="render-button" disabled>Render Document</button>

      <div id="output"></div>
      <div id="debug"></div>
    </div>

    <!-- JSZip dependency -->
    <script crossorigin src="https://unpkg.com/jszip/dist/jszip.min.js"></script>

    <script type="module">
      // Импортируем напрямую из TypeScript файла
      import { parseAsync, renderDocument } from "./src/docx2html.ts";

      // Глобальные переменные для совместимости
      window.docx = { parseAsync, renderDocument };

      // Остальной код остается без изменений
      const fileInput = document.getElementById("fileInput");
      const renderButton = document.getElementById("renderButton");
      const output = document.getElementById("output");
      const debugDiv = document.getElementById("debug");

      const options = [
        { key: "renderHeaders", label: "Render Headers", value: true },
        { key: "renderFooters", label: "Render Footers", value: true },
        { key: "renderFootnotes", label: "Render Footnotes", value: true },
        { key: "renderEndnotes", label: "Render Endnotes", value: true },
        { key: "renderComments", label: "Render Comments", value: false },
        { key: "breakPages", label: "Break Pages", value: true },
        { key: "ignoreWidth", label: "Ignore Width", value: false },
        { key: "ignoreHeight", label: "Ignore Height", value: false },
        { key: "ignoreFonts", label: "Ignore Fonts", value: false },
        { key: "ignoreLastRenderedPageBreak", label: "Ignore Last Page Break", value: true },
        { key: "experimental", label: "Experimental Features", value: false },
        { key: "debug", label: "Debug Mode", value: false },
      ];

      const optionsList = document.getElementById("optionsList");
      options.forEach((option) => {
        const div = document.createElement("div");
        div.className = "option-item";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.id = option.key;
        checkbox.checked = option.value;

        const label = document.createElement("label");
        label.htmlFor = option.key;
        label.textContent = option.label;

        div.appendChild(checkbox);
        div.appendChild(label);
        optionsList.appendChild(div);
      });

      fileInput.addEventListener("change", () => {
        renderButton.disabled = !fileInput.files.length;
      });

      renderButton.addEventListener("click", async () => {
        if (!fileInput.files.length) return;

        const file = fileInput.files[0];
        const selectedOptions = {};

        options.forEach((option) => {
          const checkbox = document.getElementById(option.key);
          selectedOptions[option.key] = checkbox.checked;
        });

        try {
          output.innerHTML = "<p>Loading document...</p>";
          debugDiv.textContent = "Parsing document...";

          const arrayBuffer = await file.arrayBuffer();
          const doc = await parseAsync(arrayBuffer);

          debugDiv.textContent = `Document parsed successfully!\nFootnotes found: ${Object.keys(doc.footnotesPart?.notes || {}).length}\nEndnotes found: ${Object.keys(doc.endnotesPart?.notes || {}).length}`;

          const result = await renderDocument(doc, output, null, selectedOptions);

          debugDiv.textContent += `\nRendering completed!`;
        } catch (error) {
          console.error("Error:", error);
          output.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
          debugDiv.textContent = `Error: ${error.message}`;
        }
      });
    </script>
  </body>
</html>
